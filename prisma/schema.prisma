generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("SUPABASE_DB_URL")
}

model Product {
  id               Int               @id @default(autoincrement())
  branchId         String
  name             String
  sku              String            // REMOVE @unique from here
  category         String
  brand            String
  purchase_price   Float?
  selling_price    Float?
  stock_quantity   Int               @default(0)
  min_stock_alert  Int               @default(0)
  created_at       DateTime          @default(now())
  updated_at       DateTime          @updatedAt
  variants         ProductVariant[]

  @@index([branchId])
  @@unique([branchId, sku]) // ADD multi-field unique constraint
}

model ProductVariant {
  id              Int      @id @default(autoincrement())
  // branchId removed previously - correct
  product         Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId       Int
  color           String
  stock_quantity  Int      @default(0)
  min_stock_alert Int      @default(0)
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt

  @@unique([productId, color])
  // branchId index removed previously - correct
}

model Supplier {
  id         Int      @id @default(autoincrement())
  branchId   String
  name       String
  contact    String?
  created_at DateTime @default(now())

  @@index([branchId])
}

enum StockType {
  IN
  OUT
}
